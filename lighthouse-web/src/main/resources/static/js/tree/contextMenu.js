if(jQuery){(function(a){a.extend(a.fn,{contextMenu:function(f,h){var e=document,g=e.documentElement,d=e.body;var c=a("#"+f.menu);var b=this.popup=function(k,n){if(f.onPopup!=null){f.onPopup(k)}a(".contextMenu").hide().find("ul").hide();if(a(k).hasClass("disabled")){return false}var p={},r,q;if(self.innerHeight){p.pageYOffset=self.pageYOffset;p.pageXOffset=self.pageXOffset;p.innerHeight=self.innerHeight;p.innerWidth=self.innerWidth}else{if(g&&g.clientHeight){p.pageYOffset=g.scrollTop;p.pageXOffset=g.scrollLeft;p.innerHeight=g.clientHeight;p.innerWidth=g.clientWidth}else{if(d){p.pageYOffset=d.scrollTop;p.pageXOffset=d.scrollLeft;p.innerHeight=d.clientHeight;p.innerWidth=d.clientWidth}}}if(!f.anchor||f.location=="mouse"){(n.pageX)?r=n.pageX:r=n.clientX+p.scrollLeft;(n.pageY)?q=n.pageY:r=n.clientY+p.scrollTop}else{if(f.anchor=="el"){r=k.position().left;q=k.position().top}}a(e).unbind("click");function i(u){var t=0,v=0;if(a(u).css("position")=="absolute"){t=u.offsetLeft;v=u.offsetTop}while(u=u.offsetParent){if(a(u).css("position")=="absolute"){t+=u.offsetLeft;v+=u.offsetTop}}return{x:t,y:v}}var m=g.clientWidth,j=g.clientHeight;var o=f.offset||{};function s(t,A){var z=i(c.parent()[0]);t+=-z.x+o.x;A+=-z.y+o.y;var u=c.width(),v=c.height();if(t+u>m){t=m-u}if(A+v>j){A=j-v}return{top:A,left:t-4}}var l=s(r,q);c.css(l).fadeIn(f.inSpeed);c.find("li").mouseover(function(){var z=a(this);var v=z.parent().find("li");v.removeClass("hover").find("ul").hide();var C=z.addClass("hover").children("ul");if(C.length>0){if(!C.attr("width")){var u=C.width();C.width(u);C.attr("width",u)}C.show();var A=z.position();var B=l.top+A.top+C.height()-j;var t=l.left+A.left+z.width()+C.width()-m;C.css({top:B>0?-B-1:-1,left:t>0?-C.width():z.width()})}return false}).mouseout(function(){c.find("li").removeClass("hover");return false});a(e).keypress(function(t){switch(t.keyCode){case 38:if(c.find("LI.hover").size()==0){c.find("LI:last").addClass("hover")}else{c.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");if(c.find("LI.hover").size()==0){c.find("LI:last").addClass("hover")}}break;case 40:if(c.find("LI.hover").size()==0){c.find("LI:first").addClass("hover")}else{c.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");if(c.find("LI.hover").size()==0){c.find("LI:first").addClass("hover")}}break;case 13:c.find("LI.hover span[action]").trigger("click");break;case 27:a(e).trigger("click");break}});c.find("LI[action]").unbind("click");c.find("LI:not(.disabled)[action]").click(function(){a(e).unbind("click").unbind("keypress");a(".contextMenu").hide().find("ul").hide();if(h){h(a(this).attr("action"),k,{x:r-o.left,y:q-o.top,docX:r,docY:q})}return false});setTimeout(function(){a(e).click(function(){a(e).unbind("click").unbind("keypress");c.fadeOut(f.outSpeed,f.afterClose||a.noop);return false})},0)};if(f.button==undefined){f.button=3}if(f.menu==undefined){return false}if(f.inSpeed==undefined){f.inSpeed=150}if(f.outSpeed==undefined){f.outSpeed=75}if(f.inSpeed==0){f.inSpeed=-1}if(f.outSpeed==0){f.outSpeed=-1}a(this).each(function(){var i=a(this);var j=a(i).offset();c.addClass("contextMenu");a(this).mousedown(function(m){var k=m,l=a(this);l.mouseup(function(n){a(this).unbind("mouseup");if(k.which==f.button){b(l,n)}return false});return false});if(a.browser.mozilla){c.each(function(){a(this).css({MozUserSelect:"none"})})}else{if(a.browser.msie){c.each(function(){a(this).bind("selectstart.disableTextSelect",function(){return false})})}else{c.each(function(){a(this).bind("mousedown.disableTextSelect",function(){return false})})}}a(i).add("UL.contextMenu").bind("contextmenu",function(){return false})});return a(this)},disableContextMenuItems:function(b){if(b==undefined){a(this).find("LI").addClass("disabled");return(a(this))}a(this).each(function(){if(b!=undefined){var e=b.split(",");for(var c=0;c<e.length;c++){a(this).find('LI[action="'+e[c]+'"]').addClass("disabled")}}});return(a(this))},enableContextMenuItems:function(b){if(b==undefined){a(this).find("LI.disabled").removeClass("disabled");return(a(this))}a(this).each(function(){if(b!=undefined){var e=b.split(",");for(var c=0;c<e.length;c++){a(this).find('span[action="'+e[c]+'"]').parent().removeClass("disabled")}}});return(a(this))},disableContextMenu:function(){a(this).each(function(){a(this).addClass("disabled")});return(a(this))},enableContextMenu:function(){a(this).each(function(){a(this).removeClass("disabled")});return(a(this))},destroyContextMenu:function(){a(this).each(function(){a(this).unbind("mousedown").unbind("mouseup")});return(a(this))}})})(jQuery)};